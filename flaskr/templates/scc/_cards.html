{% set categories = {
    'Baseline': {
        'icon': 'check_circle',
        'desc': 'Normal operation',
        'conditions': ['Default']
    },
    'HTTP Errors': {
        'icon': 'warning',
        'desc': 'Server response codes',
        'conditions': ['404 Error', '500 Error', '502 Error', '503 Error', '429 Rate Limit']
    },
    'Content & Resources': {
        'icon': 'description',
        'desc': 'Page content issues',
        'conditions': ['Validation Error', 'Content Error', 'Missing CSS', 'Missing JS', 'Broken Links', 'Uncaught Exception']
    },
    'Performance': {
        'icon': 'speed',
        'desc': 'Speed and timing',
        'conditions': ['Large Image', 'Hero Image', 'Content Delay', 'Slow TTFB', 'Timeout', 'Layout Shift']
    },
    'Server Behavior': {
        'icon': 'dns',
        'desc': 'Server-side scenarios',
        'conditions': ['Redirect Loop', 'Maintenance', 'Cookies']
    },
    'Security': {
        'icon': 'security',
        'desc': 'Attack simulations',
        'conditions': ['Security - JS Injected', 'Security - eskimmer', 'Security - Deface', 'Security - Crypto']
    }
} %}

{% set conditions = {
    'Default': {
        'icon': 'sentiment_satisfied',
        'desc': 'Healthy page with normal response time',
        'details': 'Baseline scenario representing a fully functional website. Use this to verify your synthetic tests pass under normal conditions and to establish performance benchmarks.'
    },
    '404 Error': {
        'icon': 'error',
        'desc': 'Returns HTTP 404 Not Found status',
        'details': 'Simulates a missing page or deleted resource. Tests should detect the 404 status code and alert when critical pages become unavailable.'
    },
    '500 Error': {
        'icon': 'warning',
        'desc': 'Returns HTTP 500 Internal Server Error',
        'details': 'Simulates an unhandled server exception or application crash. This is a critical error that should trigger immediate alerts in your monitoring system.'
    },
    '502 Error': {
        'icon': 'dns',
        'desc': 'Bad Gateway - upstream server error',
        'details': 'Common with load balancers and reverse proxies when backend servers are unreachable. Often indicates deployment issues or backend service failures.'
    },
    '503 Error': {
        'icon': 'power_settings_new',
        'desc': 'Service Unavailable - server overloaded',
        'details': 'Indicates the server is temporarily unable to handle requests due to maintenance or capacity issues. Should be distinguished from other 5xx errors in alerting.'
    },
    '429 Rate Limit': {
        'icon': 'speed',
        'desc': 'Too Many Requests - rate limited',
        'details': 'Returns 429 status with Retry-After header. Tests API rate limiting behavior and ensures your monitoring handles throttling gracefully without false alerts.'
    },
    'Validation Error': {
        'icon': 'check_circle',
        'desc': 'Form with client-side validation errors',
        'details': 'Page loads successfully but contains form validation errors. Tests ability to detect application-level errors that return 200 OK but indicate a problem.'
    },
    'Content Error': {
        'icon': 'bug_report',
        'desc': 'Page with broken images and missing resources',
        'details': 'HTML loads but references non-existent images. Tests detection of partial failures where the page appears broken but returns 200 status.'
    },
    'Missing CSS': {
        'icon': 'brush',
        'desc': 'Stylesheet fails to load - unstyled page',
        'details': 'Page content loads but CSS files return 404. Results in an unstyled, broken-looking page. Tests visual regression and resource loading monitoring.'
    },
    'Missing JS': {
        'icon': 'code',
        'desc': 'JavaScript fails to load - broken functionality',
        'details': 'Page renders but JavaScript files return 404. Interactive elements like buttons and forms stop working. Tests detection of silent JavaScript failures.'
    },
    'Large Image': {
        'icon': 'image',
        'desc': 'Includes 5MB image to slow page load',
        'details': 'Contains an oversized image that significantly impacts page load time. Tests performance thresholds and LCP (Largest Contentful Paint) metrics.'
    },
    'Hero Image': {
        'icon': 'photo_camera',
        'desc': 'Large hero banner affecting LCP metrics',
        'details': 'Features a large above-the-fold hero image that dominates LCP calculations. Use to test Core Web Vitals monitoring and performance budgets.'
    },
    'Content Delay': {
        'icon': 'hourglass_top',
        'desc': 'AJAX content delayed by 5 seconds',
        'details': 'Page shell loads immediately but AJAX content takes 5 seconds. Tests handling of dynamic content and ensures tests wait for full page load.'
    },
    'Slow TTFB': {
        'icon': 'schedule',
        'desc': '3 second delay before first byte',
        'details': 'Server waits 3 seconds before sending any response. Simulates slow database queries or backend processing. Tests TTFB (Time to First Byte) monitoring.'
    },
    'Timeout': {
        'icon': 'hourglass_bottom',
        'desc': 'Server delays 62s to trigger timeout',
        'details': 'Server sleeps for 62 seconds, exceeding typical 60-second timeouts. Verifies your tests properly detect and report timeout conditions.'
    },
    'Redirect Loop': {
        'icon': 'sync',
        'desc': 'Infinite redirect loop',
        'details': 'Server responds with 302 redirect to itself, creating an infinite loop. Tests detection of redirect chains and ensures monitoring fails gracefully.'
    },
    'Maintenance': {
        'icon': 'build',
        'desc': 'Scheduled maintenance page (503)',
        'details': 'Displays a friendly maintenance page with 503 status. Tests ability to distinguish planned downtime from unexpected outages in alerting rules.'
    },
    'Broken Links': {
        'icon': 'link_off',
        'desc': 'Page with links to non-existent pages',
        'details': 'All navigation and product links point to 404 pages. Tests link checking capabilities and detection of broken user journeys.'
    },
    'Uncaught Exception': {
        'icon': 'error',
        'desc': 'JavaScript throws uncaught errors on load',
        'details': 'Page triggers multiple JavaScript errors including thrown exceptions, reference errors, and type errors. Tests RUM error tracking and JavaScript error monitoring.'
    },
    'Layout Shift': {
        'icon': 'flip_to_front',
        'desc': 'Content injected causing poor CLS score',
        'details': 'Elements are dynamically injected after page load, pushing content around. Simulates poor Cumulative Layout Shift (CLS) scores for Core Web Vitals testing.'
    },
    'Cookies': {
        'icon': 'cookie',
        'desc': 'Sets test cookie on response',
        'details': 'Response includes Set-Cookie header with a test cookie. Use to verify cookie handling, session management, and consent banner testing.'
    },
    'Security - JS Injected': {
        'icon': 'code',
        'desc': 'Third-party script injection detected',
        'details': 'Page includes an unauthorized external JavaScript file. Simulates Magecart-style attacks or compromised CDN resources. Tests security monitoring.'
    },
    'Security - eskimmer': {
        'icon': 'credit_card',
        'desc': 'Simulated credit card skimmer script',
        'details': 'Injects a fake payment card skimmer targeting checkout forms. Tests detection of e-commerce skimming attacks that steal customer payment data.'
    },
    'Security - Deface': {
        'icon': 'masks',
        'desc': 'Simulated website defacement attack',
        'details': 'Page content is modified to show attacker messages. Tests visual monitoring and content integrity checks that detect unauthorized changes.'
    },
    'Security - Crypto': {
        'icon': 'memory',
        'desc': 'Cryptominer script injection',
        'details': 'Injects a fake cryptocurrency miner script (no actual mining). Tests detection of cryptojacking attacks that hijack visitor CPU resources.'
    }
} %}
{% set condition_names = {
    'default': 'Default',
    '404error': '404 Error',
    '500error': '500 Error',
    '502error': '502 Error',
    '503error': '503 Error',
    '429ratelimit': '429 Rate Limit',
    'validationerror': 'Validation Error',
    'contenterror': 'Content Error',
    'missingcss': 'Missing CSS',
    'missingjs': 'Missing JS',
    'largeimage': 'Large Image',
    'heroimage': 'Hero Image',
    'contentdelay': 'Content Delay',
    'slowttfb': 'Slow TTFB',
    'timeout': 'Timeout',
    'redirectloop': 'Redirect Loop',
    'maintenance': 'Maintenance',
    'brokenlinks': 'Broken Links',
    'uncaughtexception': 'Uncaught Exception',
    'layoutshift': 'Layout Shift',
    'cookies': 'Cookies',
    'security-jsinjected': 'Security - JS Injected',
    'security-eskimmer': 'Security - eskimmer',
    'security-deface': 'Security - Deface',
    'security-crypto': 'Security - Crypto'
} %}

<div class="space-y-4">
    {% for cat_name, cat_meta in categories.items() %}
    <div x-data="{ open: true }">
        <button @click="open = !open" class="w-full flex items-center gap-2 mb-2 group">
            <div class="w-7 h-7 rounded bg-splunk-gray-700 flex items-center justify-center">
                <span class="material-symbols-outlined text-white icon-xs">{{ cat_meta.icon }}</span>
            </div>
            <h2 class="font-semibold text-splunk-gray-700 text-sm">{{ cat_name }}</h2>
            <span class="text-xs text-splunk-gray-400">({{ cat_meta.conditions|length }})</span>
            <span class="material-symbols-outlined text-splunk-gray-400 icon-xs transition-transform duration-200 ml-1" :class="open && 'rotate-180'">expand_more</span>
            <div class="flex-1 h-px bg-splunk-gray-200 ml-2"></div>
        </button>
        <div x-show="open" x-collapse>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3">
                {% for key in cat_meta.conditions %}
                {% set meta = conditions[key] %}
                {% set newkey = key|lower|replace(' ', '') %}
                {% set is_active = condition[0] == newkey %}
                <div x-data="{ expanded: false }" class="bg-white rounded-xl shadow-sm hover:shadow-md transition-all duration-200 {% if is_active %}ring-2 ring-splunk{% endif %}">
                    <button hx-get="set/{{ newkey }}"
                            hx-target="#condition-cards"
                            hx-swap="innerHTML transition:true"
                            class="w-full text-left p-3">
                        <div class="flex items-center gap-3">
                            <div class="w-9 h-9 rounded-lg flex items-center justify-center transition-colors shrink-0
                                        {% if is_active %}bg-splunk text-white{% else %}bg-splunk-gray-100 text-splunk-gray-400{% endif %}">
                                <span class="material-symbols-outlined">{{ meta.icon }}</span>
                            </div>
                            <div class="flex-1 min-w-0">
                                <div class="flex items-center gap-2">
                                    <h3 class="font-medium text-splunk-gray-800 text-sm">{{ key }}</h3>
                                    {% if is_active %}
                                    <span class="text-[10px] font-medium text-splunk bg-splunk/10 px-1.5 py-0.5 rounded">Active</span>
                                    {% endif %}
                                </div>
                                <p class="text-xs text-splunk-gray-500 truncate">{{ meta.desc }}</p>
                            </div>
                        </div>
                    </button>
                    <div class="px-3 pb-2">
                        <button @click.stop="expanded = !expanded"
                                class="text-[11px] text-splunk-gray-400 hover:text-splunk flex items-center gap-1 transition-colors">
                            <span class="material-symbols-outlined icon-xs">info</span>
                            <span x-text="expanded ? 'Hide' : 'Details'"></span>
                        </button>
                        <div x-show="expanded" x-collapse>
                            <p class="text-xs text-splunk-gray-600 mt-1.5 leading-relaxed">{{ meta.details }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
    {% endfor %}
</div>

{% if request.headers.get('HX-Request') %}
<!-- Out-of-band swap to update the banner (only during HTMX requests) -->
<p id="condition-name" hx-swap-oob="true" class="font-semibold text-splunk-gray-800">
    {{ condition_names.get(condition[0], condition[0]) }}
</p>
{% endif %}
